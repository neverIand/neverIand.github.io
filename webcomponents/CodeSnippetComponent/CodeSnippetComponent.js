import{handleThemeChange}from"/scripts/theme.js";import"/webcomponents/ChipComponent/ChipComponent.js";const CSS='\n:host {\n  display: block;\n  --code-font: consolas, "Menlo", "Monaco", "Courier New", monospace;\n  --code-font-size: 1em;\n  --code-line-height: 125%;\n}\n.snippet-container {\n  position: relative;\n  border: 1px solid var(--border-color);\n}\n.snippet-header {\n  position: relative;\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  align-items: center;\n  padding: 5px;\n  gap: 5px;\n  color: var(--text-color);\n  border-bottom: 1px solid var(--border-color);\n  user-select: none;\n}\n.btn-wrapper {\n  flex: 1;\n  width: 100%;\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n}\n.snippet-content {\n  position: relative;\n  display: flex;\n  align-items: flex-start;\n  min-height: 1em;\n  background-color: var(--code-bg-color);\n  overflow-x: auto;\n  -webkit-overflow-scrolling: auto;\n}\n.line-numbers {\n  position: sticky;\n  position: -webkit-sticky;\n  top: 0;\n  left: 0;\n  padding: 0 5px;\n  color: var(--text-color);\n  background-color: var(--content-bg-color);\n  border-right: 1px solid;\n  user-select: none;\n}\n::slotted(pre),\npre {\n  margin: 0;\n  padding: 0 5px !important;\n  color: var(--code-color);\n  font-family: var(--code-font);\n  font-size: var(--code-font-size, 1em);\n  line-height: var(--code-line-height, 125%);\n}\n#result {\n  padding: 5px;\n}\n.text {\n  color: var(--text-color);\n  font-family: var(--code-font);\n  font-size: var(--code-font-size, 1em);\n  line-height: var(--code-line-height, 125%);\n}\n.string {\n  color: var(--code-str-color);\n}\n.symbol {\n  color: var(--text-color);\n}\n.comment,\n.comment .keyword {\n  color: var(--code-comment-color);\n  font-style: italic;\n}\n.keyword {\n  color: var(--code-kw-color);\n}\n/* HTML and CSS support */\n.attribute {\n  color: #9cdcfe;\n}\n.css-prop {\n  color: var(--code-css-prop-color);\n}\n.css-val {\n  color: var(--code-css-val-color);\n}\nbutton {\n  margin-left: 5px;\n  cursor: pointer;\n}\nlabel,\ninput[type="checkbox"] {\n  font-size: 0.8em;\n  cursor: pointer;\n}\n',canConstruct="undefined"!=typeof CSSStyleSheet&&"function"==typeof CSSStyleSheet.prototype.replaceSync,canAdopt="undefined"!=typeof ShadowRoot&&"adoptedStyleSheets"in ShadowRoot.prototype;let sharedSheet;canConstruct&&(sharedSheet=new CSSStyleSheet,sharedSheet.replaceSync(CSS));class CodeSnippet extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"});if(canAdopt&&sharedSheet)e.adoptedStyleSheets=[sharedSheet];else{const t=document.createElement("style");t.textContent=CSS,e.appendChild(t)}document.addEventListener("berry-theme",(e=>handleThemeChange(e,this)))}connectedCallback(){this.render(),this.addCopyButtonEventListener(),this.updateLineNumbers()}render(){const e=this.getAttribute("code-lang")||"javascript",t=""===this.getAttribute("nohighlight"),n=""===this.getAttribute("runnable")&&"javascript"===e,o=this.getAttribute("data-title")||"Code Snippet",s=document.createElement("template");if(s.innerHTML=`\n    <div class="snippet-container">\n        <div class="snippet-header">\n          ${o}\n          <div class="btn-wrapper">\n            <berry-chip data-label="${e}" variant="code"></berry-chip>\n            <button id="copy-btn">Copy</button>\n          </div>\n        </div>\n        <div class="snippet-content">\n            <div class="line-numbers text"></div>\n            <slot name="code">If you can't see the code snippet, it's likely that you are in Safari's reader mode. You'll need to exit reader mode to view or copy the code.</slot>\n        </div>\n    </div>\n    ${n?'\n      <div class="snippet-container">\n        <div class="snippet-header" style="justify-content: space-between;">\n          Result\n          <button id="run-btn">Run</button>\n        </div>\n        <div id="result" class="snippet-content text">\n        </div>\n      </div>':""}\n    `,this.shadowRoot.appendChild(s.content.cloneNode(!0)),!t){this.querySelector("pre").style.display="none",this.highlightCode()}n&&this.addRunButtonEventListener()}updateLineNumbers(){const e=this.shadowRoot.querySelector("slot[name='code']").assignedNodes({flatten:!0}).find((e=>e.nodeType===Node.TEXT_NODE||"PRE"===e.tagName)),t=(e?e.textContent:"").split("\n"),n=this.shadowRoot.querySelector(".line-numbers"),o=document.createDocumentFragment();for(let e=0;e<t.length;e++){const t=document.createElement("br"),n=document.createElement("span");n.textContent=`${e+1}`,o.appendChild(n),o.appendChild(t)}n.appendChild(o)}addCopyButtonEventListener(){this.shadowRoot.getElementById("copy-btn").addEventListener("click",(()=>{this.copyCodeToClipboard()}))}copyCodeToClipboard(){const e=this.shadowRoot.querySelector('slot[name="code"]').assignedNodes({flatten:!0}).map((e=>e.textContent)).join("\n");navigator.clipboard.writeText(e).then((()=>{const e="Code copied to clipboard!";console.log(e);const t=new CustomEvent("berry-toast",{detail:{type:"success",message:e}});document.dispatchEvent(t)})).catch((e=>{const t=`Failed to copy code: ${e}`;console.error(t);const n=new CustomEvent("berry-toast",{detail:{type:"error",message:t}});document.dispatchEvent(n)}))}highlightCode(){const e=this.shadowRoot.querySelector('slot[name="code"]');if(!e)return void console.error("Code slot not found");const t=e.assignedNodes({flatten:!0}).find((e=>e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE&&"PRE"===e.tagName));if(!t)return void console.error("No code node found in slot");let n=t.textContent;const o=this.getAttribute("code-lang")||"javascript";n=n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");let s="";if("html"===o)n=n.replace(/(<!--[\s\S]*?-->)/g,'<span class="comment">$1</span>'),n=n.replace(/(<\/?)([\w-]+)([^<>]*?)(\/?>)/g,(function(e,t,n,o,s){let a=t+'<span class="keyword">'+n+"</span>";return a+=o.replace(/([\w-]+)(=)("[^"]*"|'[^']*')/g,'<span class="attribute">$1</span>$2<span class="string">$3</span>'),a+s})),s=n,s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&lt;(\/?span\b[^&]*?)&gt;/g,"<$1>");else if("css"===o)s=n.replace(/(".*?"|'.*?')/g,'<span class="string">$1</span>').replace(/(\b[\w-]+)(\s*:)([^;]*)(;)/g,'<span class="css-prop">$1</span>$2<span class="css-val">$3</span>$4').replace(/(@[\w-]+)/g,'<span class="keyword">$1</span>');else{const e=[];let t;switch(o){case"python":t=/(\"\"\"[\s\S]*?\"\"\"|'''.*?'''|".*?"|'.*?'|#.*?$)|[^"'#]+/gm;break;case"javascript":t=/(\".*?\"|'.*?'|`.*?`|\/\*[\s\S]*?\*\/|\/\/.*?$)|[^"'`\/]+/gm;break;default:e.push({type:"code",value:n})}if(t){let o;for(;null!==(o=t.exec(n));)o[1]?e.push({type:"strOrComment",value:o[1]}):e.push({type:"code",value:o[0]})}e.forEach((e=>{if("code"===e.type){const t={javascript:"\\b(?:if|else|switch|case|for|while|do|break|continue|function|return|class|constructor|extends|super|new|delete|typeof|instanceof|try|catch|finally|throw|let|const|async|await|import|export|this|null|true|false|undefined|var)\\b",python:"\\b(?:def|return|if|elif|else|for|while|break|continue|class|try|except|finally|with|as|import|from|lambda|pass|raise|yield|global|nonlocal|assert|True|False|None)\\b"}[o];t&&(e.value=e.value.replace(new RegExp(t,"g"),'<span class="keyword">$&</span>'))}else if("strOrComment"===e.type){const t=e.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e.value.startsWith('"')||e.value.startsWith("'")||e.value.startsWith("`")?e.value='<span class="string">'+t+"</span>":(e.value.startsWith("/*")||e.value.startsWith("//")||e.value.startsWith("#"))&&(e.value='<span class="comment">'+t+"</span>")}})),s=e.map((e=>e.value)).join("")}const a=document.createElement("pre");a.innerHTML=s,e.insertAdjacentElement("beforebegin",a),e.style.display="none"}addRunButtonEventListener(){const e=this.shadowRoot.getElementById("run-btn");e&&e.addEventListener("click",(()=>this.runCode()))}runCode(){const e=this.shadowRoot.querySelector('slot[name="code"]').assignedNodes({flatten:!0}).map((e=>e.textContent)).join("\n"),t=this.shadowRoot.getElementById("result");t.innerHTML="";const n=console.log;console.log=(...e)=>{t.innerHTML+=e.join(" ")+"<br>"};try{new Function(e)()}catch(e){t.innerHTML=`<span style="color: red;">Error: ${e.message}</span>`}console.log=n}}customElements.get("berry-code")||customElements.define("berry-code",CodeSnippet);export default CodeSnippet;