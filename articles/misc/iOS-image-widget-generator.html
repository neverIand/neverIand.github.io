<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Widget Generator</title><link rel="manifest" href="/manifest.json"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/favicon.ico"><link rel="stylesheet" href="/styles/common.css"><style>body{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;gap:1rem}fieldset,form{display:flex;flex-direction:column;align-items:center;gap:1rem;width:100%;padding:10px}form{max-width:600px;background:#fff;border:1px solid}label{display:flex;flex-direction:column;align-items:center}legend{font-weight:700}input,select{min-width:180px}.form-row{display:flex;flex-direction:column;justify-content:space-between;align-items:center;width:100%}</style></head><body><noscript>This page requires Javascript to function properly.</noscript><header><h1>Scriptable Widget Generator</h1></header><main><form id="scriptConfigForm"><h2>Script Config</h2><p>Customize the widget through this form. Incomplete or empty settings will be ignored by the script.</p><div class="form-row"><label for="title">Title</label> <input type="text" id="title" name="title" maxlength="20"></div><div class="form-row"><label for="imgKeywords">Image keywords <span><small>comma-separated</small></span> <span><small>&lt;100 characters</small></span></label> <input type="text" id="imgKeywords" name="imgKeywords" maxlength="100"></div><fieldset><legend>Birthday Info</legend><div class="form-row"><label for="b-month-select">Month</label> <select name="b-month-select" id="b-month-select"><option value="">Select a month</option><option value="0">January</option><option value="1">Feburary</option><option value="2">March</option><option value="3">April</option><option value="4">May</option><option value="5">June</option><option value="6">July</option><option value="7">August</option><option value="8">September</option><option value="9">October</option><option value="10">November</option><option value="11">December</option></select></div><div class="form-row"><label for="b-day-select">Day</label> <select id="b-day-select" name="b-day-select"><option value="">Select a month first</option></select></div><div class="form-row"><label for="bDayImgKeywords">Image keywords <span><small>comma-separated</small></span> <span><small>&lt;100 characters</small></span></label> <input type="text" id="bDayImgKeywords" name="bDayImgKeywords" maxlength="100"></div></fieldset><fieldset><legend>Special Dates</legend><div class="form-row"><label for="s-month-select">Month</label> <select name="s-month-select" id="s-month-select"><option value="">Select a month</option><option value="0">January</option><option value="1">Feburary</option><option value="2">March</option><option value="3">April</option><option value="4">May</option><option value="5">June</option><option value="6">July</option><option value="7">August</option><option value="8">September</option><option value="9">October</option><option value="10">November</option><option value="11">December</option></select></div><div class="form-row"><label for="s-day-select">Day</label> <select id="s-day-select" name="s-day-select"><option value="">Select a month first</option></select></div><div class="form-row"><label for="sDayImgKeywords">Image keywords <span><small>comma-separated</small></span> <span><small>&lt;100 characters</small></span></label> <input type="text" id="sDayImgKeywords" name="sDayImgKeywords" maxlength="100"></div><div class="form-row"><label for="sDayMsg">Message to display</label> <input type="text" id="sDayMsg" name="sDayMsg" maxlength="20"></div><button id="addSpecialDateBtn">Add</button><div class="form-row"><span>Special Dates Added:</span><ul id="sDateList"></ul></div></fieldset><button id="submitBtn">Submit</button></form></main><berry-toast></berry-toast><script type="module" src="/webcomponents//ToastComponent/ToastComponent.js"></script><script>const M_Table=[31,isLeapYear((new Date).getFullYear())?29:28,31,30,31,30,31,31,30,31,30,31];function isLeapYear(e){return e%400==0||e%100!=0&&e%4==0}function mapToArray(e){return Array.from(e.entries())}function replacer(e,t){return t instanceof Map?{__type:"Map",value:mapToArray(t)}:t}function handleDayMonthSelect(e,t){const n=document.getElementById(t);document.getElementById(e).addEventListener("change",(function(e){console.log(e.target.value);if(!e.target.value)return void(n.innerHTML="<option value=''>Select a month</option>");n.innerHTML="";const t=document.createDocumentFragment();for(let n=0;n<M_Table[e.target.value];n++){const e=document.createElement("option");e.setAttribute("value",n+1),e.innerHTML=n+1,t.appendChild(e)}n.appendChild(t)}))}handleDayMonthSelect("b-month-select","b-day-select"),handleDayMonthSelect("s-month-select","s-day-select");let scriptConfig={title:"",month:"",day:"",bDayMsg:"",specialDates:Array.from({length:12},(()=>new Map)),imgKeywords:[],bDayImgKeywords:[]};const listEl=document.getElementById("sDateList");document.getElementById("addSpecialDateBtn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("scriptConfigForm"),n=new FormData(t),a=n.get("sDayMsg")||"",o=parseInt(n.get("s-month-select")),i=parseInt(n.get("s-day-select"));if(!i||NaN===o)return void console.error("No special date specified");const s=n.get("sDayImgKeywords").split(",").map((e=>e.trim()));if(0===s.length)return void console.error("No image keyword specified");if(console.log("scriptConfig before update:",scriptConfig.specialDates),scriptConfig.specialDates[o].get(i))return void console.error("Special day already exist");scriptConfig.specialDates[o].set(i,{msg:a,keywords:s});const r=document.createElement("li");r.innerHTML=`[MM-DD]: ${o+1}-${i}; Message: '${a||"No message"}'; Image keywords: ${s[0]?s.join(","):"No keywords"}`,listEl.appendChild(r)})),document.getElementById("submitBtn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("scriptConfigForm"),n=new FormData(t);scriptConfig={...scriptConfig,title:n.get("title"),month:parseInt(n.get("b-month-select"))||"",day:parseInt(n.get("b-day-select"))||"",bDayMsg:n.get("bDayMsg"),imgKeywords:n.get("imgKeywords").split(",").map((e=>e.trim())),bDayImgKeywords:n.get("bDayImgKeywords").split(",").map((e=>e.trim()))},console.log("scriptConfig:",scriptConfig);const a=`\n        let SCRIPT_CONFIG = ${JSON.stringify(scriptConfig,replacer)};\n        SCRIPT_CONFIG.specialDates = SCRIPT_CONFIG.specialDates.map((date) => {\n          if (date.__type === "Map") {\n            return new Map(date.value);\n          }\n          return date;\n        });\n\n        let widget = await createWidget();\n        if (config.runsInWidget) {\n          Script.setWidget(widget);\n        } else {\n          widget.presentMedium();\n        }\n        Script.complete();\n\n        async function createWidget() {\n          let widget = new ListWidget();\n\n          let titleStack = widget.addStack();\n          let titleElement = titleStack.addText(SCRIPT_CONFIG.title);\n          titleElement.textColor = Color.white();\n          titleElement.textOpacity = 0.95;\n          titleElement.font = Font.boldSystemFont(24);\n\n          widget.addSpacer(4);\n\n          let img;\n          const date = new Date();\n          const { imgKeywords, bDayImgKeywords, bDayMsg, specialDates } = SCRIPT_CONFIG;\n\n          if (isBDay(date)) {\n            img = await loadRandomImage(bDayImgKeywords);\n            renderMsg(widget, bDayMsg);\n          } else if (isSpecialDay(date)) {\n            img = await loadRandomImage(\n              specialDates[date.getMonth()].get(date.getDate()).keywords || [\n                "cat",\n                "loaf",\n              ]\n            );\n            renderMsg(\n              widget,\n              specialDates[date.getMonth()].get(date.getDate()).msg || ""\n            );\n          } else {\n            img = await loadRandomImage(imgKeywords);\n          }\n\n          widget.backgroundImage = img;\n\n          return widget;\n        }\n\n        async function loadImgMetaData(keywords) {\n          let url = 'https://loremflickr.com/json/g/540/540/'+ keywords.join(\n            ","\n          ) + '/all?random=1';\n          let req = new Request(url);\n          return await req.loadJSON();\n        }\n\n        async function loadRandomImage(keywords) {\n          let data = await loadImgMetaData(keywords);\n          let url = data.file;\n          let req = new Request(url);\n          return req.loadImage();\n        }\n\n        function isBDay(date) {\n          const { bMonth: month, bDay: day } = SCRIPT_CONFIG;\n          if (!month || !day) {\n            return false;\n          }\n          return date.getMonth() === month - 1 && date.getDate() === day;\n        }\n\n        function isSpecialDay(date) {\n          const { specialDates } = SCRIPT_CONFIG;\n          const specialMonth = specialDates[date.getMonth()];\n          if (!specialMonth) {\n            return false;\n          }\n          const specialDay = specialMonth.get(date.getDate());\n          if (!specialDay) {\n            return false;\n          }\n          return true;\n        }\n\n        function renderMsg(widget, msg) {\n          let textElement = widget.addText(msg);\n          textElement.textColor = Color.white();\n          textElement.textOpacity = 0.9;\n          textElement.font = Font.boldSystemFont(20);\n        }\n        `;navigator.clipboard.writeText(a).then((()=>{const e="Code copied to clipboard!";console.log(e);const t=new CustomEvent("berry-toast",{detail:{type:"success",message:e}});document.dispatchEvent(t)})).catch((e=>{const t=`Failed to copy code: ${e}`;console.error(t);const n=new CustomEvent("berry-toast",{detail:{type:"error",message:t}});document.dispatchEvent(n)}))}))</script></body></html>